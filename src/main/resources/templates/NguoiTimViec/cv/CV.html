<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{/NguoiTimViec/index::dynamic(~{::body})}">
<head>
<meta charset="UTF-8">
<title>CV Samples</title>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
	<div class="container">
		   <div class="product-header">
                <h1 class="product-title">CV Chuyên Nghiệp</h1>
                <p class="product-description">Mẫu CV nhỏ gọn, chuyên nghiệp giúp bạn nổi bật trong mắt nhà tuyển dụng.</p>
            </div>
		<div class="row mt-3">
			<div class="col-md-4" th:each="cv : ${cvs}">
				<div class="card">
					<div class="card-body">
						<h5 class="cart-title" th:text="${cv.name}">CV Title</h5>
						<p class="product-description" th:text="${cv.description}">CV
							Description</p>
						<p class="product-price">
							Giá: <span th:text="${cv.price}">VNĐ</span>
						</p>
						<iframe
							th:src="@{/api/files/cv/{filename}(filename=${cv.fileURL})}"
							width="100%" height="100%" class="product-image"
							style="border: none;"></iframe>

						<br>
						<!-- Thay đổi ở đây -->
						<a href="#" class="btn btn-primary btn-add-to-cart"
							th:data-cv-id="${cv.idCV}"> <i class="fa fa-cart-plus"></i>
							Mua Ngay
						</a>

					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
	function addToCart(cvId) {
	    if (!cvId) {
	        alert('CV ID không hợp lệ!');
	        return;
	    }

	    fetch('/api/cart/add?cvId=' + encodeURIComponent(cvId), {
	        method: 'POST',
	        headers: {
	            'Content-Type': 'application/json'
	        },
	        credentials: 'include' // Để gửi cookie session
	    })
	    .then(response => {
	        if (!response.ok) {
	            return response.text().then(text => {throw new Error(text)});
	        }
	        return response.text(); // Nhận phản hồi dưới dạng văn bản
	    })
	    .then(message => {
	        alert('CV đã được thêm vào giỏ hàng: ' + message);
	    })
	    .catch(error => {
	        alert('Có lỗi xảy ra: ' + error.message);
	    });
	}

	// Gán sự kiện cho các nút khi người dùng nhấp vào
	document.querySelectorAll('.btn-add-to-cart').forEach(button => {
	    button.addEventListener('click', function(event) {
	        event.preventDefault(); // Ngăn chặn hành động mặc định của liên kết
	        const cvId = this.getAttribute('data-cv-id'); // Đọc giá trị từ thuộc tính data-cv-id
	        addToCart(cvId); // Gửi yêu cầu đến API
	    });
	});

    </script>

</body>
</html>
